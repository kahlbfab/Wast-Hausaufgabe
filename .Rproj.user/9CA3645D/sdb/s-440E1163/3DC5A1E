{
    "collab_server" : "",
    "contents" : "# Hausaufgabe\n#### Aufgabe 1 ####\n\nlibrary(\"tidyr\")\nlibrary(readr)\nrequire(dplyr, quietly = T)\nlibrary(ggplot2)\n#daten einlesen\nugz_luftqualitaetsmessung_seit_2012 <- read_csv(\"C:/Users/Thha/Documents/GitHub/Wast-Hausaufgabe/ugz_luftqualitaetsmessung_seit-2012.csv\")\nluftqualitaet <- as_tibble(ugz_luftqualitaetsmessung_seit_2012)\n\n#werte und titel separieren\ntitel <- slice(luftqualitaet, c(2))\ntitel[1] <- \"Datum\"\nwerte <- slice(luftqualitaet, c(-1:-5))\n\n#tabelle nach ort auseinander nehmen\nstampfenbach <- werte %>% select(1,2:14) %>%\n  mutate(station = \"Stampfenbachstrasse\")\nstampfenbach_titel <- titel %>% select(1,2:14)\nstampfenbach_titel[15] <- \"Station\"\nnames(stampfenbach) <- stampfenbach_titel\n\nschimmel <- werte %>% select(1,15:22) %>%\n  mutate(station = \"Schimmelstrasse\")\nschimmel_titel <- titel %>% select(1,15:22)\nschimmel_titel[10] <- \"Station\"\nnames(schimmel) <- schimmel_titel\n\nheubeer <- werte %>% select(1,23:26) %>%\n  mutate(station = \"Heubeeribüel\")\nheubeer_titel <- titel %>% select(1,23:26)\nheubeer_titel[6] <- \"Station\"\nnames(heubeer) <- heubeer_titel\n\nrosengarten <- werte %>% select(1,27:30) %>%   \n  mutate(station = \"Rosengarten\")\nrosengarten_titel <- titel %>% select(1,27:30)\nrosengarten_titel[6] <- \"Station\"\nnames(rosengarten) <- rosengarten_titel\n\n#tabelle zusammensetzen\nluftqual <- bind_rows(stampfenbach, schimmel, heubeer, rosengarten)\nstr(luftqual)\n#Zahlen von character nach factor wandeln\n#numeric_change <- names(luftqual)[2:14]\n#luftqual[factor_change] <- lapply(luftqual[numeric_change], as.numeric)\n#View(luftqual)\n\n# Wetterdaten \"manipulieren\" MAster Stampfenbach , Slaves andere Stationen\nluftqual <- luftqual %>% group_by(Datum) %>% arrange(Datum) %>% fill(Lufttemperatur : Regendauer, .direction = \"down\") %>% arrange(Station)\nView(luftqual)\n\n\nluftqual[2:14] <- as_tibble(sapply(luftqual[2:14], as.numeric))\nstr(luftqual)\nView(luftqual)\n\n\n\n\n#### Aufgabe 2 ####\n#mit ggplot\ngather(luftqual, key = variable, value = value, c(2,3,4,6,7,8)) %>% \n  ggplot(aes(x = Datum, y = value, group = variable)) +\n  geom_line(aes(color = variable)) +\n  facet_wrap(~Station)\n\n#mit ggally #falscher Ansatz\nlibrary(GGally)\nggpairs(luftqual, mapping = ggplot2::aes(color = Station), columns = c(2,3,4,6,7,8),\n        upper =list(continuous = wrap(\"points\", alpha = 0.2)))\n\n\n#### Aufgabe 3 ####\n\n\nlibrary(VIM)\n\npar(mar= c(4,2,2,2))\n\n\nluftqual.A3 <- rapply(luftqual, f=function(x) ifelse(is.nan(x),NA,x), how=\"replace\")\nView(luftqual.A3)\n\nnames(luftqual.A3) <- c(\"Datum\", \"SO2\", \"CO\", \"O3_max_h1\", \"O3_nb_h1>120\", \"NO2\", \"NO\", \"PM10\", \"T\", \"Hr\", \"p\", \"WVS\", \"StrGlo\", \"RainDur\", \"Station\")\nView(luftqual.A3)\n\naggr_plot <- aggr(luftqual.A3, col=c('navyblue','red'), \n                  numbers=TRUE, sortVars=TRUE, labels=names(luftqual.A3), cex.axis=.7, gap=3, ylab=c(\"Histogram of missing data\",\"Pattern\"), cex.lab = 1.2)\n\nsum(is.na(luftqual.A3))\n\n\n\n\n### Alt nicht mehr nötig\nluftqual.NA <- luftqual %>% select(everything()) %>% summarise_all(funs(sum(is.na(.)))) %>%\n  gather(variable, value,c(2:14)) %>% select(c(3,4)) %>% ggplot(aes(reorder(x = c(1:13), -value) , y = value)) + xlab(\"\")+\n  geom_bar(stat = \"identity\", aes(fill = variable)) + theme(axis.text.x = element_blank(), axis.ticks.x=element_blank())\n\nluftqual.NA\n\n\n#### Aufgabe 4 ####\n\n# Feinstaub (PM10) jeweils fuer die Messpunkte \n# Stampfenbachstrasse, Schimmelstrasse, Rosengartenstrasse\n# !! Heubeeribüel hat keine Messung von PM10 \n\n# PM10 \n# Jahresmittelgrenzwert: 20ug/m^3\n# Tagesmittelgrenzwert: 50ug/m^3, darf max. 1x pro Jahr ueberschritten werden\n\n\n\n\n# uberschittene Tagesmittelgrenzwerte\nluftqual.PM10 <- luftqual %>% select(Datum, 'Feinstaub PM10', Station) %>%\n  mutate(PM10_uberschritt = luftqual$`Feinstaub PM10` >= 50 )\n\n#1 wie oft wird der Tagesmittel-Grenzwert an welcher Station ueberschritten?\nluftqual.PM10 %>% group_by(Station) %>% summarize(n = sum(PM10_uberschritt, na.rm = T))\n\n#2 ueberschrittenen Tagesmittelgrenzwerte fuer alle Stationen ueber die Zeit in einer Grafik\nluftqual.PM10 %>% filter(PM10_uberschritt) %>% \n  ggplot(aes(x=Datum, y=`Feinstaub PM10`)) + geom_point(aes(color = Station)) + ggtitle(\"PM10 > 50\")\n\n# Der Tagesmittelgrenzwert wird bei allen Stationen oft an den gleichen Tagen uebertroffen.\n# Dies ist gut moeglich da alle Messstatinen unter aehnlichen Einfluessen auf den Feinstaub reagieren\n# wie zb. das Wetter.\n\n#3 In welchen Jahren und Stationen ist der Anteil der Tage mit Grenzwert uberschreitungen\n# signifikant groesser als zufaellig\n\n# Jahresmittelgrenzwert = 20ug/m^3\n\n# Messwerte sind iid: independent and identically distributed\npunif(q=, min=0, max=365) # P[X <= x]\n\nluftqual.PM10 %>% group_by(Station) %>% summarize(n = sum(PM10_uberschritt, na.rm = T)) %>%\n  mutate(wkeit_n = punif(q=n, min=0, max=365))\n\n#### nicht sicher obe uniform Verteilung stimmt.\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n#### Aufgabe 5 ####\n\n# Regendauer ~ PM10 pro Station \n# select(luftqual, Datum, Regendauer)\n# PM10_temp <- luftqual %>% select(Datum,`Feinstaub PM10`, Station) %>%\n\n# regendauer zu allen Stationen hinzufuegen mit leftjoin\nordered_PM10 <- left_join(x = select(luftqual, Datum,`Feinstaub PM10`, Station),\n                          y = filter(luftqual, Station == \"Stampfenbachstrasse\") %>% select( Datum, Regendauer),\n                          by = \"Datum\")\n\n# \nggplot(ordered_PM10, aes(x= Regendauer, y= `Feinstaub PM10`)) + geom_point(aes(color = Station))\n",
    "created" : 1544558972818.000,
    "dirty" : false,
    "encoding" : "UTF-8",
    "folds" : "",
    "hash" : "184986265",
    "id" : "3DC5A1E",
    "lastKnownWriteTime" : 1544782018,
    "last_content_update" : 1544782018097,
    "path" : "~/GitHub/Wast-Hausaufgabe/HA_test_thomas.R",
    "project_path" : "HA_test_thomas.R",
    "properties" : {
    },
    "relative_order" : 2,
    "source_on_save" : false,
    "source_window" : "",
    "type" : "r_source"
}